

model Event {
  id               String              @id @default(uuid())
  EventName        String
  description      String?
  image            String?
  date             DateTime
  location         String
  category         String? 
  minParticipants  Int
  maxParticipants  Int
  fee              Float    @default(0)
  status           EventStatus @default(OPEN)
  averageRating    Float @default(0.0)

  hostId           String
  host             Profile @relation(fields: [hostId], references: [id])

  participants     EventParticipant[]
  reviews          Review[]
  payment          Payment[]

  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt

   @@map("Events")
}

model EventParticipant {
  id          String @id @default(uuid())
  userId      String
  eventId     String
  status      PaymentStatus @default(PENDING)

  user        Profile  @relation(fields: [userId], references: [id])
  event       Event  @relation(fields: [eventId], references: [id])

  createdAt    DateTime @default(now())
  updatedAt    DateTime   @updatedAt
  payment      Payment?
  review       Review?


  @@unique([userId, eventId])
  @@map("JoinEvent")

}

model Review {
  id          String @id @default(uuid())
  rating      Int
  comment     String?

  userId      String
  hostId      String
  eventId     String
  joinEventId String  @unique

  user        Profile  @relation("UserReviews", fields: [userId], references: [id])
  host        Profile  @relation("HostReviews", fields: [hostId], references: [id])
  event       Event    @relation(fields: [eventId], references: [id])
  joinEvent   EventParticipant @relation(fields: [joinEventId], references: [id])

  createdAt DateTime @default(now())
  updatedAt        DateTime   @updatedAt

   @@map("Reviews")
}

model Payment {
  id            String @id @default(uuid())
  userId        String
  eventId       String
  transactionId String?
  amount        Float
  paymentGatewayData Json?
  status        PaymentStatus @default(PENDING)

  user          Profile @relation(fields: [userId], references: [id])
  event         Event @relation(fields: [eventId], references: [id])
  joinEventId   String @unique
  joinEvent     EventParticipant @relation(fields: [joinEventId], references: [id])

  createdAt     DateTime @default(now())
  updatedAt        DateTime   @updatedAt

   @@map("payments")
}

enum EventStatus {
  OPEN
  FULL
  CANCELLED
  COMPLETED
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
}
